const kamniEls = document.querySelectorAll(".kamen");

kamniEls.forEach((kamenEl) => {
    let offsetX, offsetY, isDragging = false;

    kamenEl.style.position = "absolute";

    kamenEl.addEventListener("mousedown", (event) => {
        isDragging = true;
        offsetX = event.clientX - kamenEl.offsetLeft;
        offsetY = event.clientY - kamenEl.offsetTop;
        kamenEl.style.cursor = "grabbing";

        const onMouseMove = (event) => {
            if (isDragging) {
                kamenEl.style.left = `${event.clientX - offsetX}px`;
                kamenEl.style.top = `${event.clientY - offsetY}px`;
            }
        };

        const onMouseUp = (event) => {
            isDragging = false;
            kamenEl.style.cursor = "grab";

            kamenEl.style.visibility = "hidden";
            requestAnimationFrame(() => {
                const elementBehind = document.elementFromPoint(event.clientX, event.clientY);
                kamenEl.style.visibility = "visible";

                if (elementBehind && elementBehind.classList.contains("wagon")
                    && elementBehind.dataset.sort === kamenEl.dataset.sort) {
                    console.log(kamenEl.textContent, '->', elementBehind.textContent);
                    kamenEl.classList.add('kamen-hidden');
                }

                document.removeEventListener("mousemove", onMouseMove);
                document.removeEventListener("mouseup", onMouseUp);
            });
        };

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
    });
});


document.addEventListener('DOMContentLoaded', () => {
    const wagonsEls = document.querySelectorAll('.wagon');

    wagonsEls.forEach(wagonEl => {
        wagonEl.addEventListener('click', () => {
            console.log(wagonEl);
        })
    })

})